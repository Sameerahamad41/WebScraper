<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Web Scraper</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 900px; margin: 20px auto; }
        h1 { text-align: center; }
        input[type="text"] { width: 70%; padding: 8px; }
        button { padding: 8px 16px; cursor: pointer; }
        .section { margin-top: 20px; }
        .images img { max-width: 150px; max-height: 100px; margin: 4px; object-fit: cover; }
        .links a { display: block; margin: 3px 0; word-break: break-all; }
        video { max-width: 300px; margin: 5px; display: block; }
    </style>
</head>
<body>
<h1>Web Scraper</h1>

<div>
    <input id="urlInput" type="text" placeholder="Enter a URL to scrape" />
    <button onclick="scrape()">Scrape</button>
</div>

<div id="status" class="section"></div>

<div class="section">
    <h2>Images</h2>
    <div id="images" class="images"></div>
</div>

<div class="section">
    <h2>Links</h2>
    <div id="links" class="links"></div>
</div>

<div class="section">
    <h2>Videos</h2>
    <div id="videos" class="videos"></div>
</div>

<script>
    async function scrape() {
        const url = document.getElementById('urlInput').value.trim();
        const statusEl = document.getElementById('status');
        const imagesEl = document.getElementById('images');
        const linksEl = document.getElementById('links');
        const videosEl = document.getElementById('videos');

        if (!url) {
            statusEl.textContent = 'Please enter a URL.';
            return;
        }

        statusEl.textContent = 'Scraping...';
        imagesEl.innerHTML = '';
        linksEl.innerHTML = '';
        videosEl.innerHTML = '';

        try {
            const res = await fetch('/api/scrape?url=' + encodeURIComponent(url));
            if (!res.ok) {
                statusEl.textContent = 'Error: ' + res.status + ' ' + res.statusText;
                return;
            }
            const data = await res.json();
            statusEl.textContent = 'Scrape complete.';

            // Images
            if (Array.isArray(data.images)) {
                data.images.forEach(src => {
                    const img = document.createElement('img');
                    img.src = src;
                    imagesEl.appendChild(img);
                });
            }

            // Links
            if (Array.isArray(data.links)) {
                data.links.forEach(href => {
                    const a = document.createElement('a');
                    a.href = href;
                    a.target = '_blank';
                    a.textContent = href;
                    linksEl.appendChild(a);
                });
            }
            // Videos
            if (Array.isArray(data.videos)) {
                data.videos.forEach(v => {
                    // YouTube embeds
                    if (v.includes("youtube.com/embed")) {
                        const iframe = document.createElement("iframe");
                        iframe.src = v;
                        iframe.width = "400";
                        iframe.height = "225";
                        iframe.allow =
                            "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share";
                        iframe.allowFullscreen = true;
                        iframe.style.margin = "8px";
                        videosEl.appendChild(iframe);

                        // Direct video files (.mp4, .webm, .ogg)
                    } else if (/\.(mp4|webm|ogg)(\?|$)/i.test(v)) {
                        const video = document.createElement("video");
                        video.src = v;
                        video.controls = true;
                        video.preload = "metadata";
                        video.style.maxWidth = "400px";
                        video.style.margin = "8px";
                        videosEl.appendChild(video);

                        // Fallback: unknown type â†’ show as link
                    } else {
                        const link = document.createElement("a");
                        link.href = v;
                        link.target = "_blank";
                        link.textContent = v;
                        link.style.display = "block";
                        link.style.margin = "8px 0";
                        videosEl.appendChild(link);
                    }
                });
            }
        } catch (err) {
            console.error(err);
            statusEl.textContent = 'Error: ' + err.message;
        }
    }
</script>
</body>
</html>
